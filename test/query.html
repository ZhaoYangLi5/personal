<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>模糊查询</title>
    <style>
        * {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        div {
            text-align: center;
            padding-top: 20px;
        }
        
        input {
            position: relative;
            width: 200px;
        }
        
        ul {
            position: absolute;
            padding-top: 20px;
            width: 200px;
            margin: 0 50% 0 35%;
            display: none;
            border: 1px solid #f00;
        }
        
        li {
            padding: 3px;
            border: 1px solid silver;
            box-shadow: 1px 1px;
            background: #ccc;
        }
    </style>
</head>

<body>
    <div>
        <input type="text" id="txt">
        <button type="button" id="btn">search</button>
        <ul id="list">

        </ul>
    </div>


    <script src="./jquery-2.1.4.js"></script>
    <script>
        /**
         * Created by Steven on 2016-10-25.
         */
        var oTxt = document.getElementById('txt');
        var oBtn = document.getElementById('btn');
        var oList = document.getElementById('list');

        var fruits = [{
            name: "需求对接",
            num: 2180
        }, {
            name: "需求分析",
            num: 2181
        }, {
            name: "规划评审",
            num: 2182
        }, {
            name: "产品设计",
            num: 2183
        }, {
            name: "设计评审",
            num: 2184
        }, {
            name: "界面交互设计",
            num: 2185
        }, {
            name: "数据验证",
            num: 2186
        }, {
            name: "详细用例",
            num: 2187
        }, {
            name: "交互设计评审",
            num: 2188
        }, {
            name: "技术支持",
            num: 609
        }, {
            name: "工作汇报",
            num: 610
        }, {
            name: "用户培训",
            num: 611
        }, {
            name: "系统测试",
            num: 612
        }, {
            name: "数据准备",
            num: 613
        }, {
            name: "上线准备",
            num: 614
        }, {
            name: "验收准备",
            num: 615
        }, {
            name: "项目会议",
            num: 616
        }];
        //点击事件
        oBtn.addEventListener('click', function() {
            var keyWord = oTxt.value;
            // var fruitList = searchByIndexOf(keyWord,fruits);
            console.log(fruitList);
            var fruitList = searchByRegExp(keyWord, fruits);
            renderFruits(fruitList);
        }, false);
        //回车查询
        oTxt.addEventListener('keydown', function(e) {
            if (e.keyCode == 13) {
                var keyWord = oTxt.value;
                // var fruitList = searchByIndexOf(keyWord,fruits);
                var fruitList = searchByRegExp(keyWord, fruits);
                renderFruits(fruitList);
            }
        }, false);
        // oTxt.addEventListener('keyup', function(e) {
        //     var keyWord = oTxt.value;
        //     // var fruitList = searchByIndexOf(keyWord,fruits);
        //     var fruitList = searchByRegExp(keyWord, fruits);
        //     renderFruits(fruitList);
        //     document.getElementById('list').style.display = "block"
        // }, false);
        $("#txt").on('keyup', function() {
            var keyWord = $(this).val();
            var fruitList = searchByRegExp(keyWord, fruits);
            renderFruits(fruitList);
            $("#list").css('display', "block");
        })
        oTxt.addEventListener('blur', function(e) {
            // document.getElementById('list').style.display = "none"
        })

        function renderFruits(list) {
            if (!(list instanceof Array)) {
                return;
            }
            oList.innerHTML = '';
            var len = list.length;
            var item = null;
            for (var i = 0; i < len; i++) {
                item = document.createElement('li');
                item.innerHTML = list[i].name;
                item.dataset.num = list[i].num;
                oList.append(item);
            }
        }

        //模糊查询1:利用字符串的indexOf方法
        function searchByIndexOf(keyWord, list) {
            if (!(list instanceof Array)) {
                return;
            }
            var len = list.length;
            var arr = [];
            for (var i = 0; i < len; i++) {
                //如果字符串中不包含目标字符会返回-1
                if (list[i].indexOf(keyWord) >= 0) {
                    arr.push(list[i]);
                }
            }
            return arr;
        }
        //正则匹配
        function searchByRegExp(keyWord, list) {
            if (!(list instanceof Array)) {
                return;
            }
            var len = list.length;
            var arr = [];
            var reg = new RegExp(keyWord);
            for (var i = 0; i < len; i++) {
                //如果字符串中不包含目标字符会返回-1
                console.log(reg);
                console.log(list[i].name);
                if (list[i].name.match(reg)) {
                    arr.push(list[i]);
                }
            }
            console.log(arr);
            return arr;

        }
        renderFruits(fruits);
        $("#list").on('click', 'li', function() {
            $("#txt").val($(this).html());
            $("#txt").data('num', $(this).data('num'));
            $("#list").hide();
        })
    </script>
</body>

</html>